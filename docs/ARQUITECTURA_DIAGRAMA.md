# ğŸ—ï¸ ARQUITECTURA - GESTIÃ“N DE CLIENTES

## ğŸ“Š Diagrama de Flujo General

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MARKETMOVE APP                            â”‚
â”‚                  (Flutter + Supabase)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                           â”œâ”€ SUPERADMIN
                           â”‚  â””â”€ /clientes (ğŸ¯ NUEVO)
                           â”‚     â”œâ”€ Ver clientes
                           â”‚     â”œâ”€ Crear cliente
                           â”‚     â”œâ”€ Editar cliente
                           â”‚     â””â”€ Eliminar cliente
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚             â”‚
                 ADMIN         SUPERADMIN
                    â”‚             â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”      â”‚
          â”‚         â”‚     â”‚      â”‚
       Ventas   Gastos  Productos  Resumen
          â”‚         â”‚     â”‚      â”‚
          â”‚         â””â”€â”€â”¬â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
          â”‚            â”‚
          â””â”€â”€â”€ /resumen (Dashboard)
               â”œâ”€ Admin: Financiero
               â””â”€ Superadmin: Simple + Link Clientes

```

---

## ğŸ—‚ï¸ Estructura de Directorios

```
lib/src/features/clientes/
â”œâ”€ pages/
â”‚  â””â”€ clientes_page.dart              â† PÃGINA PRINCIPAL
â”‚     â”œâ”€ build() - Interfaz
â”‚     â”œâ”€ _buildClienteCard() - Tarjeta
â”‚     â”œâ”€ _mostrarOpciones() - Bottom sheet
â”‚     â”œâ”€ _mostrarDialogoCrearCliente() - Create
â”‚     â”œâ”€ _mostrarDialogoEditar() - Edit
â”‚     â”œâ”€ _mostrarConfirmacionEliminar() - Delete
â”‚     â””â”€ _buildDrawer() - MenÃº lateral
â”‚
â””â”€ dialogs/
   â”œâ”€ crear_cliente_dialog.dart        â† CREATE DIALOG
   â”‚  â”œâ”€ Email input
   â”‚  â”œâ”€ Full name input
   â”‚  â””â”€ Business name input
   â”‚
   â””â”€ editar_cliente_dialog.dart       â† EDIT DIALOG
      â”œâ”€ Full name input
      â”œâ”€ Business name input
      â””â”€ Email (read-only)

lib/src/shared/
â”œâ”€ repositories/
â”‚  â””â”€ data_repository.dart
â”‚     â”œâ”€ obtenerClientesAdmin() â† READ
â”‚     â”œâ”€ actualizarUsuario() â† UPDATE
â”‚     â””â”€ eliminarUsuario() â† DELETE
â”‚
â”œâ”€ widgets/
â”‚  â””â”€ admin_only_page.dart             â† ACCESS CONTROL
â”‚     â””â”€ Wrapper para proteger pÃ¡ginas
â”‚
â””â”€ models/
   â””â”€ (usuario ya existe en Supabase)

lib/main.dart
â””â”€ Route: '/clientes' => ClientesPage()

```

---

## ğŸ”„ Ciclo de Vida - Crear Cliente

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. SUPERADMIN TOCA BOTÃ“N FLOTANTE                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. MUESTRA: CrearClienteDialog                             â”‚
â”‚    - Email input (validado)                                â”‚
â”‚    - Nombre input                                          â”‚
â”‚    - Negocio input                                         â”‚
â”‚    - BotÃ³n guardar                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. USUARIO COMPLETA FORMULARIO Y TOCA "GUARDAR"            â”‚
â”‚    Validaciones:                                           â”‚
â”‚    âœ“ Email no vacÃ­o                                        â”‚
â”‚    âœ“ Email formato vÃ¡lido                                  â”‚
â”‚    âœ“ Nombre no vacÃ­o                                       â”‚
â”‚    âœ“ Negocio no vacÃ­o                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. LLAMA: Supabase.auth.signUp()                            â”‚
â”‚    Email: usuario@empresa.com                              â”‚
â”‚    Password: TempPassword123!                              â”‚
â”‚    â†“                                                        â”‚
â”‚    Response: User ID creado âœ…                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ACTUALIZA: tabla users                                  â”‚
â”‚    UPDATE users SET                                        â”‚
â”‚      full_name = 'Nombre',                                 â”‚
â”‚      business_name = 'Negocio',                            â”‚
â”‚      role = 'admin'                                        â”‚
â”‚    WHERE id = NEW_USER_ID                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. MUESTRA SNACKBAR                                        â”‚
â”‚    âœ… Cliente creado: usuario@empresa.com                  â”‚
â”‚       ContraseÃ±a: TempPassword123!                         â”‚
â”‚       Debe cambiarla al ingresar                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. STREAM SE REFRESCA                                      â”‚
â”‚    obtenerClientesAdmin() emite nueva lista                â”‚
â”‚    â†“                                                        â”‚
â”‚    StreamBuilder recibe datos                              â”‚
â”‚    â†“                                                        â”‚
â”‚    ListView se actualiza                                   â”‚
â”‚    â†“                                                        â”‚
â”‚    NUEVA TARJETA APARECE EN LISTA âœ…                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœï¸ Ciclo de Vida - Editar Cliente

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. SUPERADMIN TOCA TARJETA DE CLIENTE                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. MUESTRA: BottomSheet con opciones                       â”‚
â”‚    - Editar                                                â”‚
â”‚    - Eliminar                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. TOCA: "Editar"                                          â”‚
â”‚    Cierra bottom sheet                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. MUESTRA: EditarClienteDialog con datos precargados      â”‚
â”‚    Email: usuario@empresa.com (READ-ONLY)                  â”‚
â”‚    Nombre: [valor actual, editable]                        â”‚
â”‚    Negocio: [valor actual, editable]                       â”‚
â”‚    BotÃ³n guardar                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. USUARIO MODIFICA DATOS Y TOCA "GUARDAR"                 â”‚
â”‚    Ej: Nombre: "Juan GarcÃ­a" â†’ "Juan GarcÃ­a PÃ©rez"         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. LLAMA: actualizarUsuario(userId, datosActualizados)     â”‚
â”‚    â†“                                                        â”‚
â”‚    UPDATE users SET                                        â”‚
â”‚      full_name = 'Juan GarcÃ­a PÃ©rez',                      â”‚
â”‚      business_name = '...'                                 â”‚
â”‚    WHERE id = userId                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. MUESTRA SNACKBAR                                        â”‚
â”‚    âœ… Cliente actualizado                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. STREAM SE REFRESCA                                      â”‚
â”‚    obtenerClientesAdmin() emite datos actualizados          â”‚
â”‚    â†“                                                        â”‚
â”‚    StreamBuilder recibe nueva lista                        â”‚
â”‚    â†“                                                        â”‚
â”‚    TARJETA SE ACTUALIZA AUTOMÃTICAMENTE âœ…                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—‘ï¸ Ciclo de Vida - Eliminar Cliente

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. SUPERADMIN TOCA TARJETA DE CLIENTE                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. MUESTRA: BottomSheet con opciones                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. TOCA: "Eliminar"                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. MUESTRA: ConfirmaciÃ³n Dialog                            â”‚
â”‚    "Â¿EstÃ¡s seguro de que quieres eliminar a [nombre]?"     â”‚
â”‚    - BotÃ³n: Cancelar                                       â”‚
â”‚    - BotÃ³n: Eliminar (rojo)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. USUARIO CONFIRMA: TOCA "Eliminar"                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. LLAMA: eliminarUsuario(userId)                          â”‚
â”‚    â†“                                                        â”‚
â”‚    DELETE FROM users WHERE id = userId                     â”‚
â”‚    (Supabase Auth tambiÃ©n elimina al usuario)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. MUESTRA SNACKBAR                                        â”‚
â”‚    âœ… Cliente eliminado                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. STREAM SE REFRESCA                                      â”‚
â”‚    obtenerClientesAdmin() emite lista sin el usuario        â”‚
â”‚    â†“                                                        â”‚
â”‚    StreamBuilder recibe nueva lista                        â”‚
â”‚    â†“                                                        â”‚
â”‚    TARJETA DESAPARECE AUTOMÃTICAMENTE âœ…                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Control de Acceso - Diagrama de Flujo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USUARIO INTENTA ACCEDER A UNA RUTA                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    Â¿Autenticado?
                    /    |    \
                  NO    SÃ     
                  â”‚     â”‚      
        Redirige  â”‚     â†“      
        a /login  â”‚     â”œâ”€â†’ Â¿Rol?
                  â”‚     â”‚
                  â”‚     â”œâ”€ SUPERADMIN
                  â”‚     â”‚  â”œâ”€ /clientes â†’ âœ… ACCESO
                  â”‚     â”‚  â”œâ”€ /resumen â†’ âœ… ACCESO (dashboard simple)
                  â”‚     â”‚  â”œâ”€ /ventas â†’ âŒ REDIRIGE A /resumen (AdminOnlyPage)
                  â”‚     â”‚  â”œâ”€ /gastos â†’ âŒ REDIRIGE A /resumen (AdminOnlyPage)
                  â”‚     â”‚  â””â”€ /productos â†’ âŒ REDIRIGE A /resumen (AdminOnlyPage)
                  â”‚     â”‚
                  â”‚     â”œâ”€ ADMIN
                  â”‚     â”‚  â”œâ”€ /clientes â†’ âŒ REDIRIGE A /resumen (AdminOnlyPage)
                  â”‚     â”‚  â”œâ”€ /resumen â†’ âœ… ACCESO (dashboard financiero)
                  â”‚     â”‚  â”œâ”€ /ventas â†’ âœ… ACCESO
                  â”‚     â”‚  â”œâ”€ /gastos â†’ âœ… ACCESO
                  â”‚     â”‚  â””â”€ /productos â†’ âœ… ACCESO
                  â”‚     â”‚
                  â”‚     â””â”€ USER/OTHER
                  â”‚        â””â”€ Redirige a /login
                  â”‚
```

---

## ğŸ’¾ Estructura de Datos - Tabla users

```sql
CREATE TABLE public.users (
  id UUID PRIMARY KEY,                    -- De Supabase Auth
  email TEXT UNIQUE NOT NULL,             -- Email del usuario
  full_name TEXT,                         -- Nombre completo
  business_name TEXT,                     -- Nombre del negocio
  role TEXT CHECK (role IN ('superadmin', 'admin', 'user')),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);
```

### Ejemplo de Datos:
```
id                                 | email                    | full_name       | business_name     | role
3b8c5d29-f1e4-4c0a-b1a8-2d3e4f5a6b7c | superadmin@marketmove.com | Rafael Admin    | MarketMove Inc    | superadmin
a1b2c3d4-e5f6-4789-0123-456789abcdef | cliente1@empresa.com     | Juan GarcÃ­a      | Negocio XYZ      | admin
b2c3d4e5-f6a7-4890-1234-567890bcdef0 | cliente2@empresa.com     | MarÃ­a LÃ³pez      | Empresa ABC      | admin
```

---

## ğŸ›¡ï¸ PolÃ­ticas RLS - Mapa de Acceso

```
TABLA: public.users (Row Level Security HABILITADO)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FUNCIÃ“N SECURITY DEFINER: get_current_user_role()           â”‚
â”‚ - Consulta la tabla users sin disparar RLS                  â”‚
â”‚ - Devuelve el rol del usuario actual                        â”‚
â”‚ - Previene recursiÃ³n infinita                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

POLÃTICA 1: "superadmin_view_all_users" (SELECT)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IF: get_current_user_role() = 'superadmin'               â”‚
â”‚ THEN: Puede ver todos los registros                      â”‚
â”‚ ELSE: DENY                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

POLÃTICA 2: "admin_view_self" (SELECT)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IF: (auth.uid() = id) AND get_current_user_role()='admin'â”‚
â”‚ THEN: Puede ver solo su propio registro                  â”‚
â”‚ ELSE: DENY                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

POLÃTICA 3: "superadmin_insert_users" (INSERT)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IF: get_current_user_role() = 'superadmin'               â”‚
â”‚ THEN: Puede insertar nuevos usuarios                     â”‚
â”‚ ELSE: DENY                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

POLÃTICA 4: "superadmin_update_users" (UPDATE)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IF: get_current_user_role() = 'superadmin'               â”‚
â”‚ THEN: Puede actualizar cualquier usuario                 â”‚
â”‚ ELSE: DENY                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

POLÃTICA 5: "admin_update_self" (UPDATE)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IF: (auth.uid() = id) AND get_current_user_role()='admin'â”‚
â”‚ THEN: Puede actualizar solo su propio registro           â”‚
â”‚ ELSE: DENY                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

POLÃTICA 6: "superadmin_delete_users" (DELETE)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IF: get_current_user_role() = 'superadmin'               â”‚
â”‚ THEN: Puede eliminar usuarios                            â”‚
â”‚ ELSE: DENY                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Matriz de Permisos

```
RECURSO              | SUPERADMIN | ADMIN | USER
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€
users (SELECT)       | âœ… Todos   | âœ… Self | âŒ
users (INSERT)       | âœ…         | âŒ    | âŒ
users (UPDATE)       | âœ… Todos   | âœ… Self | âŒ
users (DELETE)       | âœ…         | âŒ    | âŒ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€
/clientes            | âœ… Full    | âŒ    | âŒ
/resumen             | âœ… Simple  | âœ… Full | âŒ
/ventas              | âŒ         | âœ…    | âŒ
/gastos              | âŒ         | âœ…    | âŒ
/productos           | âŒ         | âœ…    | âŒ
```

---

## ğŸ“± Flujo de NavegaciÃ³n

```
LOGIN SCREEN
    â†“
    â”œâ”€ Usuario: superadmin@marketmove.com
    â”œâ”€ ContraseÃ±a: [contraseÃ±a]
    â””â”€ Toca: "Ingresar"

DASHBOARD (/resumen)
    â”œâ”€ [SUPERADMIN VERSION]
    â”‚  â””â”€ "Mis Clientes: 5"
    â”‚     â””â”€ Link: Ir a GestiÃ³n de Clientes
    â”‚  â””â”€ MenÃº:
    â”‚     â”œâ”€ Panel Principal
    â”‚     â”œâ”€ Clientes (ğŸ¯ NUEVO)
    â”‚     â””â”€ Cerrar SesiÃ³n
    â”‚
    â””â”€ [ADMIN VERSION]
       â””â”€ Ventas | Gastos | Productos | Perfil
          â””â”€ MenÃº:
             â”œâ”€ Panel Principal
             â””â”€ Cerrar SesiÃ³n

GESTIÃ“N DE CLIENTES (/clientes) - SOLO SUPERADMIN
    â”œâ”€ Header: "Mis Clientes"
    â”œâ”€ FloatingActionButton (+) â†’ Crear cliente
    â”‚  â””â”€ CrearClienteDialog
    â”‚     â”œâ”€ Email: [input]
    â”‚     â”œâ”€ Nombre: [input]
    â”‚     â””â”€ Negocio: [input]
    â”‚
    â”œâ”€ Tarjeta Cliente 1
    â”‚  â”œâ”€ [Tap] â†’ BottomSheet
    â”‚  â”‚  â”œâ”€ Editar â†’ EditarClienteDialog
    â”‚  â”‚  â”‚  â”œâ”€ Nombre: [editable]
    â”‚  â”‚  â”‚  â””â”€ Negocio: [editable]
    â”‚  â”‚  â””â”€ Eliminar â†’ ConfirmationDialog
    â”‚  â”‚     â””â”€ SÃ­ â†’ Elimina
    â”‚
    â”œâ”€ Tarjeta Cliente 2
    â”‚  â””â”€ [Mismo flujo...]
    â”‚
    â””â”€ Drawer
       â”œâ”€ Panel Principal
       â”œâ”€ Clientes (Actual)
       â””â”€ Cerrar SesiÃ³n
```

---

## ğŸ”Œ IntegraciÃ³n con Supabase

```
Frontend (Flutter App)
    â”‚
    â”œâ”€ Auth Module
    â”‚  â””â”€ supabase.client.auth.signUp()
    â”‚     â””â”€ Crea usuario en Supabase Auth
    â”‚
    â”œâ”€ Database Module
    â”‚  â”œâ”€ supabase.client.from('users').select()
    â”‚  â”‚  â””â”€ StreamBuilder â†’ obtenerClientesAdmin()
    â”‚  â”‚
    â”‚  â”œâ”€ supabase.client.from('users').update()
    â”‚  â”‚  â””â”€ actualizarUsuario()
    â”‚  â”‚
    â”‚  â””â”€ supabase.client.from('users').delete()
    â”‚     â””â”€ eliminarUsuario()
    â”‚
    â””â”€ RLS Enforcement
       â”œâ”€ get_current_user_role() funciÃ³n
       â””â”€ 6 polÃ­ticas de acceso
          â””â”€ Valida operaciones por rol

Supabase Backend
    â”‚
    â”œâ”€ Auth Service
    â”‚  â””â”€ Usuarios | Roles | Tokens
    â”‚
    â”œâ”€ PostgreSQL Database
    â”‚  â””â”€ users table
    â”‚     â”œâ”€ id (UUID)
    â”‚     â”œâ”€ email
    â”‚     â”œâ”€ full_name
    â”‚     â”œâ”€ business_name
    â”‚     â””â”€ role
    â”‚
    â””â”€ Row Level Security
       â”œâ”€ PolÃ­ticas activas
       â””â”€ FunciÃ³n SECURITY DEFINER
```

---

**Diagrama versiÃ³n**: 1.0
**Ãšltima actualizaciÃ³n**: 2024
